(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{608:function(t,a,r){"use strict";r.r(a);var s=r(17),v=Object(s.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("p",[t._v("一次现网升级后暴漏的缓存问题，记录问题发生、定位、解决的过程。")]),t._v(" "),r("h2",{attrs:{id:"结论"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),r("p",[r("strong",[t._v("地址栏网址缓存")]),t._v("，nginx配置对首页的缓存策略即可。")]),t._v(" "),r("h2",{attrs:{id:"问题原因"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问题原因"}},[t._v("#")]),t._v(" 问题原因")]),t._v(" "),r("p",[t._v("安全整改，将接口参数形式传递的业务字段由请求体转移到请求头。因为浏览器缓存，导致访问前台代码不是升级后的，而后台已经新的。接口全部报错。此前也存在，只是每次都是部分需求，感知不明显。领导，包括业务第一反应是缓存，直接清缓存，访问成功。")]),t._v(" "),r("h2",{attrs:{id:"问题定位过程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问题定位过程"}},[t._v("#")]),t._v(" 问题定位过程")]),t._v(" "),r("ol",[r("li",[t._v("这里就出现定位的问题，现网只有业务和部分领导有访问权限，发现问题，他们第一时间清缓存访问，然后通知我们。导致我们没法第一时间定位。")]),t._v(" "),r("li",[t._v("我们在开发和测试环境都没有复现，对比开发与现网nginx，也没发现明显区别异常(开发环境配置的首页永不缓存)。")]),t._v(" "),r("li",[t._v("我们只能访问到现网首页没权限页面。控制台查看资源加载。发现每次刷新也是走的304，协商缓存。理论上是没有缓存问题的。所以很奇怪为何会反馈缓存问题。")]),t._v(" "),r("li",[t._v("也是各种操作，F5刷新。ctrl+F5刷新发现都没问题，直接访问url，从收藏夹直接访问首页等多种方式。发现直接通过url访问时，首页是从disk cache加载。然后问了一个有权限的人访问现网的操作。得知他们应该就是这个问题。即直接点击收藏夹触发"),r("strong",[t._v("地址栏网址缓存")])]),t._v(" "),r("li",[t._v("也在开发环境尝试，出现相同问题。")])]),t._v(" "),r("h2",{attrs:{id:"问题解决"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#问题解决"}},[t._v("#")]),t._v(" 问题解决")]),t._v(" "),r("ol",[r("li",[t._v("这个时候F5刷新即可。但是有些人不会这样，心里默认缓存要清缓存才行。")]),t._v(" "),r("li",[t._v("现网对首页资源配置 no-cache，保证每次首页从服务器进行验证。")])]),t._v(" "),r("h2",{attrs:{id:"结论-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#结论-2"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),r("p",[t._v("这只是解决访问url时浏览器地址栏缓存。但是没有根本上解决我们项目升级的问题。现网是用elb分发两台服务器。升级是无感知升级，两条机器分开升级验证。仅仅靠前台的各种缓存优化无法解决根本问题，即升级完成前后，用户一直处于访问过程。")])])}),[],!1,null,null,null);a.default=v.exports}}]);